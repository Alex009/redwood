plugins.withId('org.jetbrains.kotlin.multiplatform') {
  kotlin {
    if (plugins.hasPlugin('com.android.library')) {
      android {
        publishLibraryVariants('release')
      }
    }
    iosArm32()
    iosArm64()
    iosX64()
    js {
      browser()
    }
    jvm()
    macosX64()
    mingwX64()
    tvosX64()
    tvosArm64()
    watchosArm32()
    watchosArm64()
    macosArm64()
    iosSimulatorArm64()
    watchosSimulatorArm64()
    tvosSimulatorArm64()

    sourceSets {
      nativeMain {
      }

      nativeTest {
      }
    }

    configure([
      targets.iosArm32,
      targets.iosArm64,
      targets.iosX64,
      targets.macosX64,
      targets.mingwX64,
      targets.tvosArm64,
      targets.tvosX64,
      targets.watchosArm32,
      targets.watchosArm64,
      targets.macosArm64,
      targets.iosSimulatorArm64,
      targets.watchosSimulatorArm64,
      targets.tvosSimulatorArm64,
    ]) {
      compilations.main.source(sourceSets.nativeMain)
      compilations.test.source(sourceSets.nativeTest)
    }
  }
}
