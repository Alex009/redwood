import app.cash.redwood.buildsupport.FlexboxHelpers

apply plugin: 'org.jetbrains.kotlin.multiplatform'
apply plugin: 'org.jetbrains.kotlin.native.cocoapods'
apply plugin: 'com.vanniktech.maven.publish'
apply plugin: 'org.jetbrains.dokka' // Must be applied here for publish plugin.

kotlin {
  [
    iosArm64(),
    iosX64(),
    iosSimulatorArm64()
  ].forEach { target ->
    target.binaries.configureEach {
      linkerOpts += ["-ObjC"]
    }
  }

  cocoapods {
    summary = "Some description for a Kotlin/Native module"
    homepage = "Link to a Kotlin/Native module homepage"
    ios.deploymentTarget = "14.2"

    pod('YogaKit', '~> 1.18')
  }

  sourceSets {
    commonMain {
      kotlin.srcDir(FlexboxHelpers.get(tasks, 'app.cash.redwood.layout.uiview'))
      dependencies {
        api projects.redwoodLayoutWidget
        implementation projects.redwoodFlexbox
        implementation projects.redwoodWidgetCompose
      }
    }

    iosArm64Main {
      dependsOn commonMain
    }

    iosX64Main {
      dependsOn commonMain
    }

    iosSimulatorArm64Main {
      dependsOn commonMain
    }
  }
}
