import static co.touchlab.cklib.gradle.CompileToBitcode.Language

apply plugin: 'org.jetbrains.kotlin.multiplatform'
apply plugin: 'co.touchlab.cklib'
apply plugin: 'com.vanniktech.maven.publish'
apply plugin: 'org.jetbrains.dokka' // Must be applied here for publish plugin.

kotlin {
  iosArm64()
  iosX64()
  iosSimulatorArm64()
}

cklib {
  config.kotlinVersion = libs.versions.kotlin.get()
  config.llvmHome = "${System.getProperty("user.home")}/.konan/dependencies/apple-llvm-20200714-macos-aarch64-1"
  create("yoganative", file("src/yoga"), ["main"]) { ctb ->
    ctb.language = Language.CPP
    ctb.srcDirs = project.files(file("native/yoga"))
    ctb.compilerArgs.addAll(
      '-DKONAN_MI_MALLOC=1',
      '-fno-omit-frame-pointer',
      '-fexceptions',
      '-Wall',
      '-Werror',
      '-Wextra',
      '-fPIC',
    )
  }
}
